.fr-callout.fr-icon-information-line
  %p.fr-callout__text
    = t("campaigns.edit_recipients_tooltip")

%p= "Liste des #{campaign.available_communes.load.size} communes abritant des objets <abbr title='Monuments Historiques'>MH</abbr> #{campaign.departement.dans_nom}.".html_safe

= form_for campaign, builder: FormBuilderDsfr, url: send("#{routes_prefix}_campaign_update_recipients_path", campaign), data: { controller: "multichecker" } do |f|
  %ul.fr-btns-group.fr-btns-group--icon-left.fr-btns-group--inline-md.fr-mb-4w
    %li
      %button.fr-btn.fr-btn--secondary.fr-btn--icon-left.fr-icon-check-line{"data-action" => "multichecker#checkAll"}
        Tout sélectionner
    %li
      %button.fr-btn.fr-btn--tertiary.fr-btn--icon-left.fr-icon-close-line{"data-action" => "multichecker#uncheckAll"}
        Tout désélectionner
    %li.fr-ml-auto
      %button.fr-btn.fr-btn--primary.fr-btn--icon-left.fr-icon-checkbox-circle-fill{type: :submit} Enregistrer la sélection

  %ul.co-columns--4
    - campaign.available_communes.each do |commune|
      - checked = campaign.commune_ids.include?(commune.id)
      .fr-checkbox-group.fr-mb-1w
        %input{type: "checkbox",
          name: "campaign[recipients_attributes][][commune_id]",
          id: "campaign_recipients_attributes_commune_#{commune.id}",
          value: "#{commune.id}",
          checked: checked,
          "data-multichecker-target": "checkbox",
          disabled: !checked && !commune.can_be_campaign_recipient? }
        %label.fr-label{for: "campaign_recipients_attributes_commune_#{commune.id}"}
          %span= commune.nom
          &nbsp;
          - if commune.started?
            %span.co-text--sm (recensement en cours)
          - if commune.users.empty?
            %span.co-text--sm (pas d'email)
          - if commune.objets.empty?
            %span.co-text--sm (pas d'objets)
          %span.fr-ml-1w.fr-badge.fr-badge--sm= commune.code_insee

  .fr-mt-4w.co-text--center
    %button.fr-btn.fr-btn--primary.fr-btn--icon-left.fr-icon-checkbox-circle-fill{type: :submit} Enregistrer la sélection
